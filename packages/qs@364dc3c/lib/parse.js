var Utils=require("./utils"),internals={delimiter:"&",depth:5,arrayLimit:20,parametersLimit:1e3};internals.parseValues=function(e,t){t="string"==typeof t?t:internals.delimiter;for(var n={},r=e.split(t,internals.parametersLimit),i=0,o=r.length;o>i;++i){var a=r[i],s=-1===a.indexOf("]=")?a.indexOf("="):a.indexOf("]=")+1;if(-1===s)n[Utils.decode(a)]="";else{var l=Utils.decode(a.slice(0,s)),u=Utils.decode(a.slice(s+1));n[l]=n[l]?[].concat(n[l]).concat(u):u}}return n},internals.parseObject=function(e,t){if(!e.length)return t;var n=e.shift(),r={};if("[]"===n)r=[],r=r.concat(internals.parseObject(e,t));else{var i="["===n[0]&&"]"===n[n.length-1]?n.slice(1,n.length-1):n,o=parseInt(i,10);!isNaN(o)&&n!==i&&internals.arrayLimit>=o?(r=[],r[o]=internals.parseObject(e,t)):r[i]=internals.parseObject(e,t)}return r},internals.parseKeys=function(e,t,n){if(e){var r=/^([^\[\]]*)/,i=/(\[[^\[\]]*\])/g,o=r.exec(e);if(!Object.prototype.hasOwnProperty(o[1])){var a=[];o[1]&&a.push(o[1]);for(var s=0;null!==(o=i.exec(e))&&n>s;)++s,Object.prototype.hasOwnProperty(o[1].replace(/\[|\]/g,""))||a.push(o[1]);return o&&a.push("["+e.slice(o.index)+"]"),internals.parseObject(a,t)}}},module.exports=function(e,t,n){if(""===e||null===e||e===void 0)return{};"number"!=typeof t&&(n=t,t=internals.depth);var r="string"==typeof e?internals.parseValues(e,n):Utils.clone(e),i={};for(var o in r)if(r.hasOwnProperty(o)){var a=internals.parseKeys(o,r[o],t);i=Utils.merge(i,a)}return Utils.compact(i)};