montageDefine("07f2c2d","http-apps/negotiate",{dependencies:["q","mimeparse","./status"],factory:function(e,t){function n(e,t,n){var r=Object.keys(t),o=e.headers[n||"accept"]||"*",a=i.bestMatch(r,o);return t[a]}var r=e("q"),i=e("mimeparse"),o=e("./status");t.negotiate=n,t.Method=function(e,t){var n=Object.keys(e);return t||(t=o.methodNotAllowed),function(r){var i=r.method;return Object.has(n,i)?Object.get(e,i)(r):t(r)}};var a=function(e,t,n){return function(a,s){var l=Object.keys(a);return s||(s=o.notAcceptable),function(o){var u=o.headers[e]||"*",c=i.bestMatch(l,u);return o.terms=o.terms||{},o.terms[t]=c,Object.has(l,c)?r.when(a[c](o),function(e){return null!==n&&e&&200===e.status&&e.headers&&(e.headers[t]=c),e}):s(o)}}};t.ContentType=a("accept","content-type"),t.Language=a("accept-language","language"),t.Charset=a("accept-charset","charset"),t.Encoding=a("accept-encoding","encoding"),t.Host=function(e,t){var n=Object.keys(e).map(function(t){var n=t.split(":");return[t,n[0]||"*",n[1]||"*",e[t]]});return t||(t=o.notAcceptable),function(e){for(var r=0;n.length>r;r++){var i=n[r],o=i[0],a=i[1],s=i[2],l=i[3];if(!("*"!==a&&a!==e.hostname||"*"!==s&&s!==""+e.port))return e.terms=e.terms||{},e.terms.host=o,l(e)}return t(e)}},t.Select=function(e){return function(t){return r.when(e(t),function(e){return e(t)})}}}});