montageDefine("07f2c2d","http-apps/redirect",{dependencies:["q","url2","../http","./negotiate","./html"],factory:function(e,t){var n=e("q"),r=e("url2"),i=e("../http"),o=e("./negotiate"),a=e("./html");t.PermanentRedirect=function(e,n,r){return function(i){return t.permanentRedirect(i,e,n,r)}},t.PermanentRedirectTree=function(e,n){return function(r){return t.permanentRedirect(r,e,n,!0)}},t.TemporaryRedirect=function(e,n,r){return function(i){return t.temporaryRedirect(i,e,n,r)}},t.TemporaryRedirectTree=function(e,n){return function(r){return t.temporaryRedirect(r,e,n,!0)}},t.Redirect=function(e,n,r){return function(i){return t.redirect(i,e,n,r)}},t.RedirectTree=function(e,n){return function(r){return t.redirect(r,e,n,!0)}},t.permanentRedirect=function(e,n,r){return t.redirect(e,n,r||301)},t.permanentRedirectTree=function(e,n,r){return t.redirect(e,n,r||301,!0)},t.temporaryRedirect=function(e,n,r){return t.redirect(e,n,r||307)},t.temporaryRedirectTree=function(e,n,r){return t.redirect(e,n,r||307,!0)},t.redirectTree=function(e,n,r){return t.redirect(e,n,r,!0)},t.redirect=function(e,n,i,a){i=i||(e.permanent?301:307),n=r.resolve(e.url,n),a&&(n=r.resolve(n,e.pathInfo.replace(/^\//,"")));var s={};s["text/plain"]=t.redirectText,e.handleHtmlFragmentResponse&&(s["text/html"]=t.redirectHtml);var l=o.negotiate(e,s)||t.redirectText;return l(e,n,i)},t.redirectText=function(e,t,n){var r=(e.permanent?"Permanent redirect\n":"Temporary redirect\n")+"See: "+t+"\n";return r.length,{status:n,headers:{location:t,"content-type":"text/plain"},body:[r]}},t.redirectHtml=function(e,t,n){var r=e.permanent?"Permanent redirect":"Temporary redirect";return{status:n,headers:{location:t,"content-type":"text/html"},htmlTitle:r,htmlFragment:{forEach:function(e){e("<h1>"+a.escapeHtml(r)+"</h1>\n"),e('<p>See: <a href="'+a.escapeHtml(t)+'">'+a.escapeHtml(t)+"</a></p>\n")}}}},t.RedirectTrap=function(e,r){return r=r||20,function(o,a){function s(){n.fcall(function(){return e(o,a)}).then(function(e){if(t.isRedirect(e)){if(!l--)throw Error("Maximum redirects.");o.url=e.headers.location,s()}else u.resolve(e)}).fail(u.reject)}var l=r,u=n.defer();return o=i.normalizeRequest(o),s(),u.promise}},t.isRedirect=function(e){return s[e.status]||!1};var s={301:!0,302:!0,303:!0,307:!0}}});