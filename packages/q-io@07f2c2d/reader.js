function Reader(e,t){function n(){var e;return e=t?s.join(""):r.constructor.join(s),s.splice(0,s.length),e}var r=Object.create(Reader.prototype);t&&e.setEncoding&&e.setEncoding(t);var i=Q.defer(),o=Q.defer();e.on("error",function(e){i.reject(e)});var a,s=[];return e.on("end",function(){i.resolve(r),o.resolve()}),e.on("data",function(e){i.resolve(r),a?a(e):s.push(e)}),r.read=function(){a=void 0;var e=Q.defer();return Q.done(o.promise,function(){e.resolve(n())}),e.promise},r.forEach=function(e){return s&&s.length&&e(n()),a=e,Q.when(o.promise,function(){a=void 0})},r.close=function(){e.destroy()},r.node=e,i.promise}function read(e,t){var n=[];return e.forEach(function(e){n.push(e)}),t?n.join(""):join(n)}function join(e){var t,n,r,i,o=0,a=e.length;for(n=0;a>n;n++)r=e[n],o+=r.length;for(i=new Buffer(o),t=0,n=0;a>n;n++)r=e[n],r.copy(i,t,0),t+=r.length;return e.splice(0,a,i),i}var Q=require("q");module.exports=Reader,Reader.read=read,Reader.join=join;