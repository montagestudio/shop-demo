montageDefine("3d3086e","bind",{dependencies:["./parse","./algebra","./stringify","./compile-observer","./compile-binder","./compile-assigner","./observers","./binders","./scope"],factory:function(e,t,n){function i(e,t,n){n.target=e,n.targetPath=t;var i=n.source=n.source||e,u=n["<-"]||n["<->"]||"",c=n.twoWay="<->"in n;n.sourcePath=u,n.value;var h=n.parameters=n.parameters||i,d=n.document,p=n.components,m=n.trace,v=n.sourceScope=new f(i);v.parameters=h,v.document=d,v.components=p;var g=n.targetScope=new f(e);if(g.parameters=h,g.document=d,g.components=p,n.converter){var _=n.converter;_.convert&&(n.convert=_.convert.bind(_)),_.revert&&(n.revert=_.revert.bind(_))}else if(n.reverter){var b=n.reverter;b.convert&&(n.revert=b.convert.bind(b)),b.revert&&(n.convert=b.revert.bind(b))}var y=n.convert,w=n.revert,C=n.sourceSyntax=a(u),E=n.targetSyntax=a(t),P=s(E,C);if(E=P[0],C=P[1],c&&"rangeContent"===E.type)return o(g,E.args[0],v,C,y,w,n,m?{sourcePath:l(C),targetPath:l(E.args[0])}:null);m&&console.log("DEFINE BINDING",t,"<-",u,e);var S=r(g,E,v,C,y,n,m),P=s(C,E);C=P[0],E=P[1];var O=Function.noop;return c&&(m&&console.log("DEFINE BINDING",t,"->",u,i),O=r(v,C,g,E,w,n,m)),function(){S(),O()}}function r(e,t,n,i,r,o,a){var s=u(i);r&&(s=d.makeConverterObserver(s,r,n));var h=c(t);return h(s,n,e,o,a?{sourcePath:l(i),targetPath:l(t)}:null)}function o(e,t,n,i,r,o,a,s){function l(e,t,n){v||(v=!0,s&&console.log("RANGE CONTENT PROPAGATED",s.targetPath,"<-",s.sourcePath,"PLUS",e,"MINUS",t,"AT",n),f.swap(n,t.length,e),v=!1)}function c(e,t,n){v||(v=!0,s&&console.log("RANGE CONTENT PROPAGATED",s.targetPath,"->",s.sourcePath,"PLUS",e,"MINUS",t,"AT",n),m.swap(n,t.length,e),v=!1)}function d(){if(m!==f){s&&console.log("RANGE CONTENT BOUND",s.targetPath,"<->",s.sourcePath),v=!0;var t=p(m,l,n),i=p(f,c,e);return v=!1,function(){s&&console.log("RANGE CONTENT UNBOUND",s.targetPath,"<->",s.sourcePath),t(),i()}}}var f,m,v,g=u(i),_=u(t),b=h(i),y=h(t),w=Function.noop;v=!0;var C=_(function(e){w(),w=Function.noop,s&&console.log("RANGE CONTENT TARGET",s.targetPath,"SET TO",e),e&&e.addRangeChangeListener&&(f=e,m&&f?(s&&console.log("RANGE CONTENT TARGET REPLACES SOURCE",s.targetPath,"->",s.sourcePath,"WITH",f),v=!0,m.swap(0,m.length,f),v=!1,w=d()):m||v||(s&&console.log("RANGE CONTENT TARGET INITIALIZED TO COPY OF SOURCE",s.targetPath,"<-",tarce.sourcePath,"WITH",m),b(f.clone(),n)))},e);v=!1;var E=g(function(t){w(),w=Function.noop,s&&console.log("RANGE CONTENT SOURCE",s.sourcePath,"SET TO",t),t&&t.addRangeChangeListener&&(m=t,f&&m?(s&&console.log("RANGE CONTENT SOURCE REPLACES TARGET",s.targetPath,"<-",s.sourcePath,"WITH",m),v=!0,f.swap(0,f.length,m),v=!1,w=d()):f||y(m.clone(),e))},n);return f||m||b([],n),function(){w(),C(),E()}}var a=e("./parse"),s=e("./algebra"),l=e("./stringify"),u=e("./compile-observer"),c=e("./compile-binder"),h=e("./compile-assigner"),d=e("./observers"),p=d.observeRangeChange;e("./binders");var f=e("./scope");n.exports=i}});