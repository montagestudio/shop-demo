function bind(e,t,n){n.target=e,n.targetPath=t;var i=n.source=n.source||e,r=n["<-"]||n["<->"]||"",o=n.twoWay="<->"in n;n.sourcePath=r,n.value;var a=n.parameters=n.parameters||i,s=n.document,l=n.components,u=n.trace,c=n.sourceScope=new Scope(i);c.parameters=a,c.document=s,c.components=l;var h=n.targetScope=new Scope(e);if(h.parameters=a,h.document=s,h.components=l,n.converter){var d=n.converter;d.convert&&(n.convert=d.convert.bind(d)),d.revert&&(n.revert=d.revert.bind(d))}else if(n.reverter){var p=n.reverter;p.convert&&(n.revert=p.convert.bind(p)),p.revert&&(n.convert=p.revert.bind(p))}var f=n.convert,m=n.revert,v=n.sourceSyntax=parse(r),g=n.targetSyntax=parse(t),_=solve(g,v);if(g=_[0],v=_[1],o&&"rangeContent"===g.type)return bindRangeContent(h,g.args[0],c,v,f,m,n,u?{sourcePath:stringify(v),targetPath:stringify(g.args[0])}:null);u&&console.log("DEFINE BINDING",t,"<-",r,e);var b=bindOneWay(h,g,c,v,f,n,u),_=solve(v,g);v=_[0],g=_[1];var y=Function.noop;return o&&(u&&console.log("DEFINE BINDING",t,"->",r,i),y=bindOneWay(c,v,h,g,m,n,u)),function(){b(),y()}}function bindOneWay(e,t,n,i,r,o,a){var s=compileObserver(i);r&&(s=Observers.makeConverterObserver(s,r,n));var l=compileBinder(t);return l(s,n,e,o,a?{sourcePath:stringify(i),targetPath:stringify(t)}:null)}function bindRangeContent(e,t,n,i,r,o,a,s){function l(e,t,n){p||(p=!0,s&&console.log("RANGE CONTENT PROPAGATED",s.targetPath,"<-",s.sourcePath,"PLUS",e,"MINUS",t,"AT",n),h.swap(n,t.length,e),p=!1)}function u(e,t,n){p||(p=!0,s&&console.log("RANGE CONTENT PROPAGATED",s.targetPath,"->",s.sourcePath,"PLUS",e,"MINUS",t,"AT",n),d.swap(n,t.length,e),p=!1)}function c(){if(d!==h){s&&console.log("RANGE CONTENT BOUND",s.targetPath,"<->",s.sourcePath),p=!0;var t=observeRangeChange(d,l,n),i=observeRangeChange(h,u,e);return p=!1,function(){s&&console.log("RANGE CONTENT UNBOUND",s.targetPath,"<->",s.sourcePath),t(),i()}}}var h,d,p,f=compileObserver(i),m=compileObserver(t),v=compileAssigner(i),g=compileAssigner(t),_=Function.noop;p=!0;var b=m(function(e){_(),_=Function.noop,s&&console.log("RANGE CONTENT TARGET",s.targetPath,"SET TO",e),e&&e.addRangeChangeListener&&(h=e,d&&h?(s&&console.log("RANGE CONTENT TARGET REPLACES SOURCE",s.targetPath,"->",s.sourcePath,"WITH",h),p=!0,d.swap(0,d.length,h),p=!1,_=c()):d||p||(s&&console.log("RANGE CONTENT TARGET INITIALIZED TO COPY OF SOURCE",s.targetPath,"<-",tarce.sourcePath,"WITH",d),v(h.clone(),n)))},e);p=!1;var y=f(function(t){_(),_=Function.noop,s&&console.log("RANGE CONTENT SOURCE",s.sourcePath,"SET TO",t),t&&t.addRangeChangeListener&&(d=t,h&&d?(s&&console.log("RANGE CONTENT SOURCE REPLACES TARGET",s.targetPath,"<-",s.sourcePath,"WITH",d),p=!0,h.swap(0,h.length,d),p=!1,_=c()):h||g(d.clone(),e))},n);return h||d||v([],n),function(){_(),b(),y()}}var parse=require("./parse"),solve=require("./algebra"),stringify=require("./stringify"),compileObserver=require("./compile-observer"),compileBinder=require("./compile-binder"),compileAssigner=require("./compile-assigner"),Observers=require("./observers"),observeRangeChange=Observers.observeRangeChange,Binders=require("./binders"),Scope=require("./scope");module.exports=bind;